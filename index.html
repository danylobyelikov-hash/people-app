<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>График</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f5f5f7">
<style>
body{font-family:-apple-system,system-ui;margin:0;background:#f5f5f7}
header{padding:16px;font-size:22px;font-weight:700}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ddd;padding:8px}
input{width:100%;box-sizing:border-box;padding:6px}
button{margin:8px;padding:10px;border-radius:10px;border:none;background:#007aff;color:#fff}
.people{padding:10px}
label{display:flex;align-items:center;gap:8px;margin:6px 0}
</style>
</head>
<body>
<header>График</header>
<div style="padding:10px">
Дата: <input type="date" id="date">
</div>

<table id="tbl"></table>

<div style="padding:10px">
<button onclick="addRow()">+ Работник</button>
</div>

<div class="people">
<h3>Подтверждение</h3>
<div id="peopleList"></div>
</div>

<script>
const KEY="crew_app_v1";
let data=JSON.parse(localStorage.getItem(KEY)||'{"cols":4,"rows":3,"cells":[],"workers":{},"date":""}');

document.getElementById("date").value=data.date||"";
document.getElementById("date").onchange=e=>{
 data.date=e.target.value;
 save();
};

function save(){
 localStorage.setItem(KEY,JSON.stringify(data));
}

function render(){
 const tbl=document.getElementById("tbl");
 tbl.innerHTML="";
 let cols=4;
 let rows=data.rows||3;

 // header time
 let tr=document.createElement("tr");
 for(let c=0;c<cols;c++){
   let th=document.createElement("th");
   th.innerHTML='Time:<br><input type="time" onchange="setCell(0,'+c+',this.value)">';
   tr.appendChild(th);
 }
 tbl.appendChild(tr);

 // машина
 tr=document.createElement("tr");
 for(let c=0;c<cols;c++){
   let td=document.createElement("td");
   td.innerHTML='<input placeholder="Машина" onchange="setCell(1,'+c+',this.value)">';
   tr.appendChild(td);
 }
 tbl.appendChild(tr);

 // crew rows
 for(let r=0;r<rows;r++){
   tr=document.createElement("tr");
   for(let c=0;c<cols;c++){
     let td=document.createElement("td");
     td.innerHTML='<input placeholder="Имя" onchange="setCrew('+r+','+c+',this.value)">';
     tr.appendChild(td);
   }
   tbl.appendChild(tr);
 }
 renderPeople();
}

function setCell(r,c,v){
 save();
}

function setCrew(r,c,v){
 if(v.trim()){
   data.workers[v]=data.workers[v]||false;
 }
 save();
 renderPeople();
}

function addRow(){
 data.rows=(data.rows||3)+1;
 save();
 render();
}

function renderPeople(){
 const list=document.getElementById("peopleList");
 list.innerHTML="";
 Object.keys(data.workers).forEach(name=>{
   let label=document.createElement("label");
   label.innerHTML='<input type="checkbox" '+(data.workers[name]?'checked':'')+' onchange="toggleWorker(\''+name+'\',this.checked)"> '+name;
   list.appendChild(label);
 });
}

function toggleWorker(name,val){
 data.workers[name]=val;
 save();
}

render();
</script>
</body>
</html>
